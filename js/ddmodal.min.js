/*!
  * DDModal
  * Author: Nguyen Hieu Dien (nguyenhieudien@hotmail.com)
  * nguyenhieudien.com/ddmodal
*/
function DDModalConfigClass(){function getRootWebSitePath(){var _location=document.location.toString(),applicationNameIndex=_location.indexOf("/",_location.indexOf("://")+3),applicationName=_location.substring(0,applicationNameIndex)+"/",webFolderIndex=_location.indexOf("/",_location.indexOf(applicationName)+applicationName.length),webFolderFullPath;return _location.substring(0,webFolderIndex)+"/"}this.BOOTSTRAPVER=4,this.ROOTPATH=getRootWebSitePath(),this.FILEFORMAT=[".html",".xhtml",".xml",".php",".txt",".asp",".aspx",".jsp",".csp",".wml"],this.SYMBOLTAGINCLUDE="::",this.setConfigs=function(customConfigs){for(var key in customConfigs)switch(key.toUpperCase()){case"BOOTSTRAPVER":this.BOOTSTRAPVER=customConfigs[key];break;case"ROOTPATH":this.ROOTPATH=customConfigs[key];break;case"FILEFORMAT":this.FILEFORMAT=customConfigs[key];break;case"SYMBOLTAGINCLUDE":this.SYMBOLTAGINCLUDE=customConfigs[key]}}}var DDModalConfig=new DDModalConfigClass;function DDModalConstantClass(){this.ERR_ELEMENTLOAD="ERROR WHEN LOAD ELEMENT SELECTOR",this.ERR_URLLOAD="ERROR WHEN LOAD URL: ",this.ERR_URLELEMENTLOAD="ERROR WHEN LOAD ELEMENT IN URL"}var DDModalConstant=new DDModalConstantClass,ddmodalArray;function DDModalClass(ddmodalTag,elementButton,elementModal,extendUI){this.ddmodalTag=ddmodalTag,this.elementButton=elementButton,this.elementModal=elementModal,this.extendUI=extendUI,this.getDDModalHTML=function(){var html="";return html+=this.elementButton.getElementButtonHTML(),html+=this.elementModal.getElementModalHTML()}}function ElementButtonClass(bttarget,bttype,btclick,btlabel,btclass){this.bttarget=bttarget,this.bttype=bttype,this.btclick=btclick,this.btlabel=btlabel,this.btclass=btclass||"btn btn-primary",this.getElementButtonHTML=function(){var html="<button></button>";return(this.bttype||"#"!==this.btclick||this.btlabel||this.btclass)&&("button"===this.bttype?(html='<button type="button" onclick="'+this.btclick+'" class="'+this.btclass+' btn-ddmodal" data-toggle="modal" data-target="#'+this.bttarget+'">',html+=this.btlabel,html+="</button>"):(html='<a type="button" onclick="'+this.btclick+'" class="'+this.btclass+' btn-ddmodal" data-toggle="modal" data-target="#'+this.bttarget+'">',html+=this.btlabel,html+="</a>")),html}}function ElementModalClass(mdid,mdtitle,mdbody,mdinclude,mdincludeType,mdclass){function getMDContentFromTag(element){var mdbody="";return $(element).length?($(element).show(),mdbody=$(element)[0].outerHTML,$(element).remove()):mdbody=DDModalConstant.ERR_ELEMENTLOAD+" "+element,mdbody}function getMDContentFromFile(filepath){var file=DDModalConfig.ROOTPATH+filepath,mdbody="",xhttp=new XMLHttpRequest;return xhttp.open("GET",file,!1),xhttp.onreadystatechange=function(){mdbody=4==this.readyState&&200==this.status?this.responseText:DDModalConstant.ERR_URLLOAD+xhttp.status+" "+xhttp.statusText+" "+file},xhttp.send(null),mdbody}function getMDContentFromFileTag(mdid,filepath,element){var ddmodalid="#"+mdid,mdbody="",filecontent=getMDContentFromFile(filepath);return $(ddmodalid+" .modal-body-ddmodal").html(filecontent),mdbody=$(ddmodalid+" .modal-body-ddmodal "+element).length?$(ddmodalid+" .modal-body-ddmodal "+element)[0].outerHTML:DDModalConstant.ERR_URLELEMENTLOAD+" "+element+" in "+filepath}function splitMDClass(mdclass){var mdclassresult=[],mdclassarr;return mdclassresult.headerclass="",mdclassresult.bodyclass="",mdclassresult.modalclass="",mdclass.split(" ").forEach(function(element){-1!==element.indexOf("md-header")?mdclassresult.headerclass+=" "+element:-1!==element.indexOf("md-body")?mdclassresult.bodyclass+=" "+element:mdclassresult.modalclass+=" "+element}),mdclassresult}this.mdid=mdid,this.mdtitle=mdtitle,this.mdbody=mdbody,this.mdinclude=mdinclude,this.mdincludeType=mdincludeType,this.mdclass=splitMDClass(mdclass),this.getElementModalHTML=function(){var html='<div class="modal fade modal-ddmodal" id="'+this.mdid+'" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">';return html+='<div class="modal-dialog '+this.mdclass.modalclass+' modal-dialog-ddmodal" role="document">',html+='<div class="modal-content modal-content-ddmodal">',html+="<! -- header here --\x3e",html+=this.getModalHeaderHTML(),html+='<div class="modal-body'+this.mdclass.bodyclass+' modal-body-ddmodal">',html+="<! -- body here --\x3e",html+="Loading "+this.mdinclude,html+="</div>",html+="<! -- footer here --\x3e",html+="</div>",html+="</div>",html+="</div>"},this.getModalHeaderHTML=function(){var html,innerhtml;return html=innerhtml="",this.mdtitle&&(DDModalConfig.BOOTSTRAPVER<4?(innerhtml='<button type="button" class="close" data-dismiss="modal" aria-label="Close">',innerhtml+='<span aria-hidden="true">&times;</span>',innerhtml+="</button>",innerhtml+='<h5 class="modal-title modal-title-ddmodal" id="exampleModalLabel">'+this.mdtitle+"</h5>"):(innerhtml='<h5 class="modal-title modal-title-ddmodal" id="exampleModalLabel">'+this.mdtitle+"</h5>",innerhtml+='<button type="button" class="close" data-dismiss="modal" aria-label="Close">',innerhtml+='<span aria-hidden="true">&times;</span>',innerhtml+="</button>"),html='<div class="modal-header '+this.mdclass.headerclass+'">',html+="<! -- header here --\x3e",html+=innerhtml,html+="</div>"),html},this.loadBodyContent=function(){if(0===this.mdincludeType&&(this.mdbody=getMDContentFromTag(this.mdinclude)),1===this.mdincludeType&&(this.mdbody=getMDContentFromFile(this.mdinclude)),2===this.mdincludeType){var symbolIndex=this.mdinclude.indexOf(DDModalConfig.SYMBOLTAGINCLUDE),filepath=this.mdinclude.substring(0,symbolIndex),element=this.mdinclude.substring(symbolIndex+DDModalConfig.SYMBOLTAGINCLUDE.length);this.mdbody=getMDContentFromFileTag(this.mdid,filepath,element)}var selectorModalBody="#"+this.mdid+" .modal-body-ddmodal";$(selectorModalBody).html(this.mdbody)}}function DDModalExtendUIClass(draggable,resizable){this.draggable=draggable,this.resizable=resizable,this.affectExtendUI=function(mdid){var ddmodalid="#"+mdid;null!=resizable&&$(ddmodalid+" .modal-content").resizable({minHeight:300,minWidth:300}),null!=draggable&&$(ddmodalid+" .modal-dialog").draggable(),$(ddmodalid).on("show.bs.modal",function(){$(this).find(".modal-body").css({"max-height":"100%"})})}}function DDModalServiceClass(){function checkMdincludeType(mdinclude){var mdincludeType=0;return DDModalConfig.FILEFORMAT.forEach(function(element){if(mdinclude.indexOf(element)>-1)return-1===mdinclude.indexOf(DDModalConfig.SYMBOLTAGINCLUDE)?(mdincludeType=1,!1):(mdincludeType=2,!1)}),mdincludeType}this.renderAllDDModal=function(){var bttarget,bttype,btclick,btlabel,btclass,mdid,mdtitle,mdbody,mdinclude,mdincludeType,mdclass,resizable,draggable,error="",ddmodal="";ddmodalArray=[];for(var tags=document.getElementsByTagName("ddmodal");tags.length>0;)if(ddmodalTag=tags[0],bttarget=bttype=btclick=btlabel=btclass=mdid=mdtitle=mdbody=mdinclude=mdincludeType=mdclass="",bttarget=ddmodalTag.getAttribute("id")?ddmodalTag.getAttribute("id"):"",bttype=ddmodalTag.getAttribute("bttype")?ddmodalTag.getAttribute("bttype"):"",btclick=ddmodalTag.getAttribute("btclick")?ddmodalTag.getAttribute("btclick"):"",btlabel=ddmodalTag.getAttribute("btlabel")?ddmodalTag.getAttribute("btlabel"):"",btclass=ddmodalTag.getAttribute("btclass")?ddmodalTag.getAttribute("btclass"):"",mdid=ddmodalTag.getAttribute("id")?ddmodalTag.getAttribute("id"):"",mdtitle=ddmodalTag.getAttribute("mdtitle")?ddmodalTag.getAttribute("mdtitle"):"",mdincludeType=checkMdincludeType(mdinclude=ddmodalTag.getAttribute("mdinclude")?ddmodalTag.getAttribute("mdinclude"):""),mdclass=ddmodalTag.getAttribute("mdclass")?ddmodalTag.getAttribute("mdclass"):"",resizable=ddmodalTag.getAttribute("resizable"),draggable=ddmodalTag.getAttribute("draggable"),""===mdid&&(error+="Attribute id is require! "),""===mdinclude&&(error+="Attribute mdinclude is require! "),0===mdincludeType&&$(mdinclude).length&&$(mdinclude).hide(),""===error){var elementButton=new ElementButtonClass(bttarget,bttype,btclick,btlabel,btclass),elementModal=new ElementModalClass(mdid,mdtitle,mdbody,mdinclude,mdincludeType,mdclass),extendUI=new DDModalExtendUIClass(draggable,resizable);ddmodal=new DDModalClass(ddmodalTag,elementButton,elementModal,extendUI),ddmodalArray.push(ddmodal),ddmodalTag.outerHTML=ddmodal.getDDModalHTML(),extendUI.affectExtendUI(mdid)}else ddmodalTag.outerHTML=error},this.fetchAll=function(){return ddmodalArray},this.getElementModalByBttarget=function(bttaget){var elementModal;return ddmodalArray.forEach(function(element){if(bttaget=="#"+element.elementModal.mdid)return elementModal=element.elementModal,!1}),elementModal},this.getMdincludeByMdid=function(mdid){var mdinclude="";return ddmodalArray.forEach(function(element){if(mdid===element.elementModal.mdid)return mdinclude=element.elementModal.mdinclude,!1}),mdinclude}}$(function(){var DDModalService=new DDModalServiceClass;DDModalService.renderAllDDModal(),$(document).on("click","button",function(event){var elementModal;$(event.currentTarget).hasClass("btn-ddmodal")&&DDModalService.getElementModalByBttarget(event.currentTarget.getAttribute("data-target")).loadBodyContent()}),$(document).on("click","a",function(event){var elementModal;$(event.currentTarget).hasClass("btn-ddmodal")&&DDModalService.getElementModalByBttarget(event.currentTarget.getAttribute("data-target")).loadBodyContent()})});